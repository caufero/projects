# CauferoAppStarter Documentation
## Transfer Lists and How They Are Implemented and Used (Two-List Assignment UI)

> Purpose of this doc  
> Train an AI Agent to implement **transfer lists** (move items from one list to another) in CauferoAppStarter WebViewer pages using the Role Details sample.  
> A transfer list is used to assign or unassign many items quickly (example: assign menu links to a role).  
> This doc covers the data contract, HTML structure, required attributes, move logic, sorting, and how to save back to FileMaker.

---

## 1) What ‚ÄúTransfer List‚Äù Means in CauferoAppStarter

A transfer list is a UI component that displays:

- **List A (Unassigned / Available items)**
- **List B (Assigned / Selected items)**

Each row is an item (usually an `<li>`), and the user can move an item between the two lists.

Typical use cases:
- Assign menu links to a role
- Assign permissions to a role
- Assign tags to a record
- Assign users to a group
- Assign features/modules to a subscription

In this framework, the transfer list is implemented with:
- plain HTML `<ul>` lists
- `<li>` rows generated by FileMaker scripts (value list scripts)
- a JavaScript `moveItem()` function
- a save function that collects item IDs from the ‚Äúassigned‚Äù list and calls a FileMaker script

---

## 2) Where the Transfer List Lives in the Page

In the sample:
- The page has a Summary Section (Save/Cancel)
- The transfer list lives inside Tab1 HTML after the basic fields

Placement pattern:
- Header text (e.g., "Menu Assignments")
- `.cards_row` container
- two `.note-card` cards
- each card has a header and a `<ul>` list

AI Agent rule:
- Put transfer lists inside the most relevant ‚ÄúDetails‚Äù tab, below the identifier fields (Role Name) so the user knows what entity they are editing.

---

## 3) Data Contracts (What FileMaker Must Provide)

The transfer list requires two sets of list items:

1) **All Items Not Assigned** (List A)
2) **Items Assigned** (List B)

In the sample these are produced by `Get Value List` scripts:

~~~filemaker
Perform Script [ ‚ÄúGet Value List‚Äù ; Parameter: "Table In First Card|Links|" & $$Role ID ]
Set Variable [ $All Links ; Value: Get ( ScriptResult ) ]

Perform Script [ ‚ÄúGet Value List‚Äù ; Parameter: "Table In Second Card|Selected Role's Links|" & $$Role ID ]
Set Variable [ $Role's Links ; Value: Get ( ScriptResult ) ]
~~~

AI Agent rule:
- The transfer list does not fetch data in JS.
- FileMaker must inject HTML list rows into `$All Links` and `$Role's Links`.

---

## 4) Required HTML Structure

### 4.1 Outer layout (two cards side by side)

The sample pattern:

~~~html
<div class='cards_row'>

  <!-- Card 1 -->
  <div class='note-card'>
    <div class='note-header'>Menu Links Not Assigned To {{ROLE_NAME}}</div>
    <div class='note-content'>
      <ul id='list1'>
        {{ALL_LINKS_LI_HTML}}
      </ul>
    </div>
  </div>

  <!-- Card 2 -->
  <div class='note-card'>
    <div class='note-header'>Menu Links Assigned To {{ROLE_NAME}}</div>
    <div class='note-content'>
      <ul id='list2'>
        {{ASSIGNED_LINKS_LI_HTML}}
      </ul>
    </div>
  </div>

</div>
~~~

### 4.2 Each item row must be an `<li>` with attributes

The move logic and saving depend on `<li>` attributes.

Minimum required attributes per `<li>`:
- `data-id` : the record ID to save
- `data-order` : numeric order used for sorting when moved

Example `<li>` template (recommended):
~~~html
<li data-id="{{ID}}" data-order="{{ORDER}}">
  <span class="item-label">{{LABEL}}</span>
  <button class="transfer-btn" onclick="moveItem(this, 'list2', 'right')">
    <i class="fas fa-arrow-right"></i>
  </button>
</li>
~~~

For an item already in the assigned list, the button should point left:

~~~html
<li data-id="{{ID}}" data-order="{{ORDER}}">
  <span class="item-label">{{LABEL}}</span>
  <button class="transfer-btn" onclick="moveItem(this, 'list1', 'left')">
    <i class="fas fa-arrow-left"></i>
  </button>
</li>
~~~

AI Agent rule:
- Each list item MUST include `data-id`.
- Each list item MUST include `data-order` (or sorting will be unpredictable).
- Each list item MUST include a move button that calls `moveItem(button, targetListId, direction)`.

---

## 5) The Move Logic (JavaScript)

The transfer list is powered by the `moveItem()` function in the sample.

### 5.1 Move item between lists and flip arrow direction

Sample function behavior:
- Identify the `<li>` via `button.parentElement`
- Append the `<li>` to the target list
- Change the arrow icon to match direction
- Update onclick to reverse direction next time
- Sort the destination list by `data-order`

Reference logic (as used):

~~~javascript
function moveItem(button, targetListId, direction) {
    const item = button.parentElement;
    const targetList = document.getElementById(targetListId);
    const iconClass = direction === 'left' ? 'fa-arrow-left' : 'fa-arrow-right';

    button.innerHTML = `<i class='fas ${iconClass}'></i>`;
    button.onclick = () => moveItem(
        button,
        targetListId === 'list1' ? 'list2' : 'list1',
        direction === 'left' ? 'right' : 'left'
    );

    targetList.appendChild(item);

    /* Sort the target list by the order field */
    sortList(targetList);
}
~~~

### 5.2 Sort list after moving

Sorting uses `data-order`:

~~~javascript
function sortList(list) {
    const items = Array.from(list.children);

    items.sort((a, b) => {
        const orderA = parseInt(a.getAttribute('data-order'), 10);
        const orderB = parseInt(b.getAttribute('data-order'), 10);
        return orderA - orderB;
    });

    items.forEach(item => list.appendChild(item));
}
~~~

AI Agent rule:
- Always re-sort after move to keep a stable predictable UI.
- Sorting depends on numeric `data-order` values. Ensure your FileMaker generated `<li>` rows include valid numeric order.

---

## 6) Saving the Assigned Items Back to FileMaker

The save process must collect IDs from the assigned list (List B).

In sample:
- `list2` is the assigned list
- it collects `data-id` from each `<li>` in `#list2`
- then passes `role` and `list2Ids` to a FileMaker script

Sample save logic:

~~~javascript
function saveItemInfo() {

    const role = document.getElementById('role').value;

    const list2Ids = Array.from(document.querySelectorAll('#list2 li'))
      .map(item => item.getAttribute('data-id'));

    const parameters = [ role, list2Ids ].join('|');

    FileMaker.PerformScript('Save Role', parameters);
}
~~~

### Important parameter formatting rule
`list2Ids` is a JavaScript array. When coerced to string, it becomes a comma-separated list:

Example:
~~~text
["12","55","88"] -> "12,55,88"
~~~

AI Agent rule:
- Your FileMaker save script must expect the assigned IDs as a comma-separated string OR you must explicitly join with a delimiter you control.

Recommended explicit join (safer):
~~~javascript
const list2Ids = Array.from(document.querySelectorAll('#list2 li'))
  .map(item => item.getAttribute('data-id'))
  .join(',');
~~~

Then:
~~~javascript
const parameters = [ role, list2Ids ].join('|');
~~~

---

## 7) CSS Expectations

The transfer list layout relies on these structural classes:
- `.cards_row` for the two-card row layout
- `.note-card` for each list card
- `.note-header` and `.note-content` for card structure

Additionally, transfer list item styling should support:
- horizontal row alignment inside `<li>`
- right-aligned move button
- clear hover states

Recommended CSS (if not already in `üñåÔ∏è Use Details CSS`):

~~~css
.cards_row { display: flex; gap: 20px; align-items: flex-start; }
.note-card { flex: 1; }
.note-content ul { list-style: none; padding: 0; margin: 0; }
.note-content li { display: flex; align-items: center; justify-content: space-between; padding: 10px; border-bottom: 1px solid rgba(0,0,0,0.08); }
.transfer-btn { border: 0; background: transparent; cursor: pointer; }
~~~

AI Agent rule:
- If the global theme CSS does not style `ul/li` rows cleanly, add local CSS for list readability and button alignment.

---

## 8) Build Pattern (FileMaker + WebViewer)

### Step-by-step build contract
To implement a transfer list in a new page, the AI Agent must do:

1) Decide the entity and assignment relationship
   - Example: Role to Links
   - Example: User to Roles
   - Example: Item to Categories

2) Create the two list datasets in FileMaker
   - Available items (not assigned)
   - Assigned items (already assigned)

3) Use `Get Value List` scripts to return `<li>` HTML for each list
   - Each `<li>` must include:
     - `data-id`
     - `data-order`
     - button calling `moveItem(...)`

4) Inject those HTML strings into:
   - `<ul id='list1'>...</ul>`
   - `<ul id='list2'>...</ul>`

5) Include `moveItem()` and `sortList()` JS
6) Implement `saveItemInfo()` to collect IDs from list2 and call a FileMaker save script

---

## 9) Empty List Handling

When one list is empty:
- It should still render as an empty `<ul>`
- Optionally show a ‚ÄúNo items‚Äù placeholder row

Recommended placeholder `<li>`:
~~~html
<li class="empty-state" data-order="999999" data-id="">
  <span>No items found</span>
</li>
~~~

AI Agent rule:
- Do not break JS by inserting rows without `data-order` if your sort function assumes it exists.
- If you add placeholders, exclude them from saving by ensuring `data-id` is blank and filtering them out in JS.

Example filter:
~~~javascript
const list2Ids = Array.from(document.querySelectorAll('#list2 li'))
  .map(li => li.getAttribute('data-id'))
  .filter(id => id && id.trim().length);
~~~

---

## 10) Common Failure Modes and Fixes

### 10.1 Buttons stop working after move
Cause:
- the button is not inside the `<li>` as direct parent-child
Fix:
- enforce `<button>` as direct child of `<li>` so `button.parentElement` is correct

### 10.2 Sorting becomes random or throws NaN
Cause:
- missing `data-order` or non-numeric value
Fix:
- ensure every `<li>` has a numeric `data-order`

### 10.3 Save script receives weird formatting
Cause:
- passing JS array directly without join
Fix:
- always `.join(',')` in JS, and parse in FileMaker

### 10.4 Duplicate items appear in both lists
Cause:
- FileMaker list generation includes the same item in both outputs
Fix:
- enforce clean separation in SQL or logic used to build the two lists

---

## 11) Required Clarifications (Ambiguities the AI Agent Cannot Guess)

These must be clarified for a perfect, consistent transfer list generator:

1) **Exact `<li>` row HTML returned by `Get Value List`**
   - Does it already include the move button HTML?
   - If yes: what is the exact onclick signature and direction convention?

2) **Sorting rules**
   - Is `data-order` derived from:
     - menu position order
     - alphabetical order
     - table field `Order`
   - Should the UI always preserve the original system order?

3) **Save script parameter contract**
   - Does `Save Role` expect:
     - comma-separated IDs
     - return-delimited IDs
     - JSON array
   - If return-delimited is preferred, the JS must join with `'\n'` instead of comma.

4) **Uniqueness and duplicates**
   - Are links unique by ID always, or can ‚Äúsame name different link‚Äù exist?
   - If duplicates can exist, the UI label must include a unique descriptor.

5) **Multi-card layout styling**
   - Is `.cards_row` always available in theme CSS?
   - If not, should the AI Agent inject a standard cards_row CSS block every time?

---

## 12) AI Agent Output Standard (What Must Be Produced)

When asked to implement a transfer list, the AI Agent must output:

1) FileMaker steps:
   - Variables holding HTML list rows for List A and List B
   - Each list row must carry `data-id` and `data-order`

2) HTML:
   - Two `<ul>` elements with stable IDs (example: list1, list2)
   - Two card containers, consistent with the system UI patterns

3) JavaScript:
   - `moveItem(button, targetListId, direction)`
   - `sortList(list)`
   - `saveItemInfo()` collecting assigned IDs and calling `FileMaker.PerformScript(...)`

4) Save contract:
   - Document what delimiter is used for IDs (comma, return, JSON)