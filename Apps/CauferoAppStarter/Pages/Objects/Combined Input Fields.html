# CauferoAppStarter Documentation
## Combined Fields (Grouped Inputs in One Visual Control) How They Are Implemented and Used

> Purpose of this doc  
> Train an AI Agent to correctly implement **combined fields** in CauferoAppStarter WebViewer pages, including:
> 1) What a combined field is in this framework  
> 2) The HTML structure used to render multiple inputs as one grouped control  
> 3) How dropdowns and text inputs are mixed inside the combined control  
> 4) How values are preloaded from FileMaker variables  
> 5) How values are read and saved back to FileMaker  
> 6) Layout rules, IDs, and common failure mode fixes

This documentation is based on the pattern in your sample page under Tab 1, where **Full Name** is implemented as a combined field:
- `title` (dropdown)
- `first_name` (text)
- `other_names` (text)
- `last_name` (text)

The combined control is rendered using:
- `combined-inputs-container`
- `combined-inputs-dropdown`
- `combined-inputs-input`

---

## 1) What a Combined Field Means in CauferoAppStarter

A combined field is a UI pattern where multiple related fields are grouped so the user experiences them as one unit.

Examples:
- Full Name: Title + First + Other + Last
- Address: Street + City + Region + Country (possible future use)
- Dimensions: Length + Width + Height + Unit (possible future use)
- Currency Amount: Amount + Currency (possible future use)

In your framework, combined fields are not a special input type.
They are standard HTML controls arranged as a single grouped layout.

---

## 2) Why Combined Fields Exist (UI and Data Reasons)

Combined fields are used when:
1. the fields are logically one thing (Full Name)
2. users should not mentally treat them as separate sections
3. you want one label for the group, not one label per input
4. you want a compact layout that looks intentional and modern

---

## 3) Canonical Combined Field Pattern (Full Name Example)

### 3.1 HTML structure from the sample page
Your page uses this exact structure:

~~~html
<div class='form-group form-group-2'>
  <label for='size'>Full Name</label>

  <div class='combined-inputs-container'>
    <select class='combined-inputs-dropdown' id='title' aria-label='Title' style='width:50%'>
      {{TITLES_HTML}}
    </select>

    <input class='combined-inputs-input' type='text' id='first_name' placeholder='First Name' aria-label='Length' style='width:50%' value='{{FIRST_NAME}}'>

    <input class='combined-inputs-input' type='text' id='other_names' placeholder='Other Names' aria-label='Length' style='width:50%' value='{{OTHER_NAMES}}'>

    <input class='combined-inputs-input' type='text' id='last_name' placeholder='Last Name' aria-label='Length' style='width:50%' value='{{LAST_NAME}}'>
  </div>
</div>
~~~

### 3.2 Combined field components
A combined field has:
1. One wrapper form group
2. One label (for the whole group)
3. One `combined-inputs-container`
4. Multiple inputs inside, each with its own ID

---

## 4) Mandatory Rules (Non-Negotiable)

### 4.1 Every inner input MUST have a stable `id`
Even though the UI groups fields, the data model is separate.
Saving depends on input IDs.

Example IDs:
- `title`
- `first_name`
- `other_names`
- `last_name`

### 4.2 Only one label for the combined group
Do not create separate `<label>` tags for each internal input.
Use placeholders and aria-labels instead.

### 4.3 Each internal input MUST have a placeholder or aria-label
Because there is one label for the group, each internal control must identify itself.

Example:
- `placeholder='First Name'`
- `aria-label='Title'`

### 4.4 Combined fields must be saved as separate values
Even if the combined UI looks like one field, the save logic treats each piece independently.

---

## 5) Preloading Combined Field Values (FileMaker Side)

### 5.1 Values are prepared as separate variables
Your script sets:
~~~filemaker
Set Variable [ $Title ; Value: GetValue ( $Link Record As List ; 2 ) ]
Set Variable [ $First Name ; Value: GetValue ( $Link Record As List ; 3 ) ]
Set Variable [ $Other Names ; Value: GetValue ( $Link Record As List ; 5 ) ]
Set Variable [ $Last Name ; Value: GetValue ( $Link Record As List ; 4 ) ]
~~~

### 5.2 Dropdown options for title are generated by `Get Value List`
Your script:
~~~filemaker
Perform Script [ ‚ÄúGet Value List‚Äù ; Parameter: "Dropdown|Titles|" & $Title ]
Set Variable [ $Titles HTML ; Value: Get ( ScriptResult ) ]
~~~

Then injects:
~~~html
<select id='title'> " & $Titles HTML & " </select>
~~~

---

## 6) Saving Combined Field Values (JavaScript)

### 6.1 Canonical save pattern from your page
Your save function reads each internal field separately:

~~~js
const staff_number = document.getElementById('staff_number').value;

const title = document.getElementById('title').value;
const first_name = document.getElementById('first_name').value;
const other_names = document.getElementById('other_names').value;
const last_name = document.getElementById('last_name').value;
~~~

Then joins parameters:
~~~js
const parameters = [ staff_number, title, first_name, other_names, last_name, ... ].join('|');
FileMaker.PerformScript('Save Staff', parameters);
~~~

### 6.2 Encoding rules for combined fields
In your sample page, the name inputs are not encoded.
This is acceptable if:
- names do not contain the delimiter `|`
- you trust the input

But safest approach:
- encode everything that could contain delimiter characters

Recommended safe pattern:
~~~js
const first_name = encodeURIComponent(document.getElementById('first_name').value);
const other_names = encodeURIComponent(document.getElementById('other_names').value);
const last_name = encodeURIComponent(document.getElementById('last_name').value);
~~~

If your system has a strict standard for what must be encoded, clarify it.

---

## 7) Layout and Styling Rules

### 7.1 Grid container placement
Your combined field sits in:
- `form-grid1`
and the internal inputs align in a grouped row/stack based on CSS.

Example wrapper:
~~~html
<div class='form-grid1'>
  <div class='form-group form-group-2'>
    ...
  </div>
</div>
~~~

### 7.2 CSS contract (assumed)
The combined control relies on CSS classes:
- `.combined-inputs-container`
- `.combined-inputs-dropdown`
- `.combined-inputs-input`

The AI Agent must assume:
- these classes already exist in your CSS scripts (`üñåÔ∏è Use Details CSS` / `üñåÔ∏è Use Dashboard CSS`)
- they are designed to create a unified visual group (shared border radius, spacing, background, etc.)

If these classes vary by theme, the agent should not override them unless required.

### 7.3 Width usage
Your sample uses inline `style='width:50%'` on each input.
This suggests:
- you intentionally enforce sizes at the field level

Rule for the AI Agent:
- match the local pattern of width control (inline style) when adding new combined fields to existing pages.

If you later standardize widths purely in CSS, update this rule.

---

## 8) Combined Fields With Mixed Control Types

A combined field can include:
- dropdown + text inputs (your Full Name example)
- text + datepicker
- number + unit dropdown
- prefix + main value + suffix

### 8.1 Rules for mixing types
1. Each internal control must have:
   - stable ID
   - placeholder or aria-label
2. Special controls keep their own scripts:
   - datepicker: must still be listed in dateFields initialization
   - dropdown: must still be populated via Mode A or Mode B
3. The combined control does not change how each input is wired, only how it is laid out

---

## 9) Copy-Paste Templates

### 9.1 Template A: Dropdown + 2 text inputs
~~~html
<div class='form-group form-group-2'>
  <label>Group Label</label>

  <div class='combined-inputs-container'>
    <select class='combined-inputs-dropdown' id='field_a' aria-label='Field A' style='width:30%'>
      {{OPTIONS_HTML}}
    </select>

    <input class='combined-inputs-input' type='text' id='field_b' placeholder='Field B' aria-label='Field B' style='width:35%' value='{{FIELD_B}}'>

    <input class='combined-inputs-input' type='text' id='field_c' placeholder='Field C' aria-label='Field C' style='width:35%' value='{{FIELD_C}}'>
  </div>
</div>
~~~

JS read example:
~~~js
const field_a = document.getElementById('field_a').value;
const field_b = document.getElementById('field_b').value;
const field_c = document.getElementById('field_c').value;
~~~

### 9.2 Template B: 2 text inputs + datepicker
~~~html
<div class='form-group form-group-2'>
  <label>Group Label</label>

  <div class='combined-inputs-container'>
    <input class='combined-inputs-input' type='text' id='x' placeholder='X' aria-label='X' style='width:35%' value='{{X}}'>

    <input class='combined-inputs-input' type='text' id='y' placeholder='Y' aria-label='Y' style='width:35%' value='{{Y}}'>

    <div style='position: relative; width:30%'>
      <input class='combined-inputs-input' type='text' id='z_date' aria-label='Z Date' value='{{Z_DATE_MYSQL}}' style='width:100%'>
      <i class='fas fa-calendar-alt' id='z_date_icon' style='position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #666; cursor: pointer;'></i>
    </div>
  </div>
</div>
~~~

JS date integration:
- add `{ id: 'z_date', iconId: 'z_date_icon' }` into dateFields
- read with `getMySQLFormattedDate('z_date')`

---

## 10) Quality Checklist for the AI Agent

When implementing combined fields, the AI Agent must verify:

### Structure
1. One label covers the group
2. One `combined-inputs-container` wraps all internal controls
3. Every internal control has:
   - stable ID
   - placeholder or aria-label

### Data
4. Each internal control is preloaded correctly:
   - text inputs via `value='...'`
   - dropdown via injected `<option>` HTML or JS population

### Save
5. Each internal control is read separately in JS
6. Values are included in parameters in correct order
7. Values are encoded if needed for delimiter safety

### Integration
8. Special controls still obey their own required scripts:
   - datepicker fields must be registered for initialization
   - dynamic dropdowns must be populated

---

## 11) Common Failure Modes and Fixes

### 11.1 Only the first control saves, others are ignored
Cause:
- JS save function reads only one field
Fix:
- ensure all internal IDs are read and included in parameter list

### 11.2 Dropdown inside combined field appears empty
Cause:
- forgot to inject `$Options HTML`
Fix:
- ensure:
  - `<select ...> " & $OptionsHTML & " </select>`

### 11.3 Combined field looks broken (spacing and borders wrong)
Cause:
- missing CSS class names or mismatched structure
Fix:
- ensure:
  - wrapper is exactly `combined-inputs-container`
  - inner controls use `combined-inputs-input` or `combined-inputs-dropdown`

### 11.4 Accessibility confusion
Cause:
- multiple inputs with only one label
Fix:
- ensure each input has placeholder or aria-label

---

## 12) Clarifications Needed (Ambiguities the AI Agent Cannot Guess)

These must be clarified for perfect AI implementation:

1. **Encoding rule**
   - Do you want combined field text inputs encoded like textareas, or only certain fields?
   - Your sample does not encode name fields, but encoding is safer.

2. **Required vs optional segments**
   - In Full Name:
     - is `title` required?
     - are `other_names` optional?
   - The AI Agent needs validation rules.

3. **Width standard**
   - Your sample uses inline widths (50% each).
   - Is this required always, or can the agent rely on CSS only?

4. **CSS class contract**
   - Are `.combined-inputs-*` classes guaranteed across all themes?
   - If not, what is the fallback pattern?

---

## 13) Implementation Standard (What the AI Agent Must Produce)

When asked to implement a combined field in CauferoAppStarter, the AI Agent must produce:

1. A wrapper form group with one label
2. A `combined-inputs-container` holding multiple inputs
3. Each internal input:
   - has stable ID
   - has placeholder or aria-label
   - is preloaded correctly from FileMaker variables
4. Save logic reads and saves each component separately
5. Any special controls inside the combined group still obey their own initialization rules