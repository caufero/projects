# Get Script Parameters

Set Variable [ $$Staff Education ID ; Value: GetValue ( GetScriptParameters ; 1 ) ]

#
# Details HTML

Set Variable [ $Save Updates Script ; Value: "Save Staff Education" ]
Set Variable [ $Cancel Script ; Value: "Close Window" ]
Set Variable [ $Delete Record Script ; Value: "" ]
Set Variable [ $Insert Image Script ; Value: "" ]

#
#
#
#
# Set details in a variable
#

Set Variable [ $List ; Value:
    Let (
        [
            sql = "SELECT \"Institution\", \"Programme\", \"Result\", \"Start Date\", \"Finish Date\"
                   FROM \"Staff Education\"
                   WHERE \"ID\" = ?" ;
            fieldseparator = "|" ;
            rowseparator = "¬∂" ;
            id = $$Staff Education ID ;
            result = ExecuteSQL ( sql ; fieldseparator ; rowseparator ; id )
        ] ;
        result
    )
]

Set Variable [ $Total ; Value: ValueCount ( $List ) ]

#

If [ $Total > 0 ]

    Loop
        Set Variable [ $i ; Value: $i + 1 ]
        Set Variable [ $Link Record ; Value: GetValue ( $List ; $i ) ]
        Set Variable [ $Link Record As List ; Value: Substitute ( $Link Record ; "|" ; ¬∂ ) ]

        #

        Set Variable [ $Institution ; Value: GetValue ( $Link Record As List ; 1 ) ]
        Set Variable [ $Programme ; Value: GetValue ( $Link Record As List ; 2 ) ]
        Set Variable [ $Result ; Value: GetValue ( $Link Record As List ; 3 ) ]
        Set Variable [ $Start Date ; Value: GetValue ( $Link Record As List ; 4 ) ]
        Set Variable [ $End Date ; Value: GetValue ( $Link Record As List ; 5 ) ]

        #

        Exit Loop If [ $i ‚â• $Total ]

        #

    End Loop

#

Else

End If

#
#
# ******************************************
# ******************************************
# GENERATE PAGE (START)
# ******************************************
# ******************************************
#
# CSS

Perform Script [ "üñåÔ∏è Use Modal CSS" ]

Set Variable [ $styles ; Value: Get ( ScriptResult ) ]

#
#
# HTML

Set Variable [ $HTML ; Value:
    "
    <div class='modal'>

          <!-- Title Section -->
          <div class='modal-header'>Education Details</div>

          <!-- Body Section -->
          <div class='modal-body'>
             <form id='update-form'>
                <div class='form-grid1'>

                   <div class='form-group-2'>
                      <label for='institution'>Institution</label>
                      <input type='text' id='institution' value='" & $Institution & "'>
                   </div>

                   <div class='form-group-2'>
                      <label for='programme'>Programme</label>
                      <input type='text' id='programme' value='" & $Programme & "'>
                   </div>

                   <div class='form-group-2'>
                      <label for='result'>Result</label>
                      <input type='text' id='result' value='" & $Result & "'>
                   </div>

                   <div class='form-group-2'>
                      <label for='start_date'>Start Date</label>
                      <div style='position: relative;'>
                         <input type='text' id='start_date' value='" & $Start Date & "'>
                         <i class='fas fa-calendar-alt' id='start_date_icon' style='position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #666; cursor: pointer;'></i>
                      </div>
                   </div>

                   <div class='form-group-2'>
                      <label for='end_date'>End Date</label>
                      <div style='position: relative;'>
                         <input type='text' id='end_date' value='" & $End Date & "'>
                         <i class='fas fa-calendar-alt' id='end_date_icon' style='position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: #666; cursor: pointer;'></i>
                      </div>
                   </div>

                </div>
             </form>
          </div>

          <!-- Button Section -->
          <div class='modal-footer'>
             <button type='button' class='save-button' onclick=\"saveUpdates()\">
                <i class='fas fa-save'></i>
                Save
             </button>
             <button type='button' class='cancel-button' onclick=\"cancelUpdates()\">
                <i class='fas fa-times'></i>
                Cancel
             </button>
          </div>

    </div>
    "
]

#
#
# Javascript

Set Variable [ $Cancel Updates Script ; Value:
    "function cancelUpdates() {
         FileMaker.PerformScript('" & $Cancel Script & "');
    }"
]

Set Variable [ $Show Datepicker ; Value:
    "
    document.addEventListener('DOMContentLoaded', function () {
        const dateFields = [
            { id: 'start_date', iconId: 'start_date_icon' },
            { id: 'end_date', iconId: 'end_date_icon' }
        ];

        function formatMySQLDateToReadable(mysqlDate) {
            const parsedDate = flatpickr.parseDate(mysqlDate, 'Y-m-d');
            return parsedDate ? flatpickr.formatDate(parsedDate, 'l, j F, Y') : '';
        }

        dateFields.forEach(field => {
            const dateInput = document.getElementById(field.id);
            const dateIcon = document.getElementById(field.iconId);
            const initialDate = dateInput.value && dateInput.value !== '--' ? dateInput.value : null;

            if (initialDate) {
                dateInput.value = formatMySQLDateToReadable(initialDate);
            }

            const flatpickrInstance = flatpickr(dateInput, {
                dateFormat: 'l, j F, Y',
                defaultDate: initialDate || null,
                allowInput: true,
                onChange: function (selectedDates, dateStr) {
                    dateInput.value = dateStr;
                }
            });

            if (dateIcon) {
                dateIcon.addEventListener('click', function () {
                    flatpickrInstance.open();
                });
            }
        });
    });

    function getMySQLFormattedDate(fieldId) {
        const dateInput = document.getElementById(fieldId).value;
        if (!dateInput || dateInput === '--') {
            return null;
        }
        const parsedDate = flatpickr.parseDate(dateInput, 'l, j F, Y');
        return parsedDate ? flatpickr.formatDate(parsedDate, 'Y-m-d') : null;
    }
    "
]

Set Variable [ $Save Updates Script ; Value:
    "function saveUpdates() {
         const institution = document.getElementById('institution').value;
         const programme = document.getElementById('programme').value;
         const result = document.getElementById('result').value;
         const start_date = getMySQLFormattedDate('start_date');
         const end_date = getMySQLFormattedDate('end_date');

         const parameters = [ institution, programme, result, start_date, end_date ].join('|');

         FileMaker.PerformScript('" & $Save Updates Script & "', parameters);
    }"
]

#

Set Variable [ $Scripts ; Value:
    "<script> " &
    $Save Updates Script & "¬∂¬∂" &
    $Cancel Updates Script & "¬∂¬∂" &
    $Show Datepicker
    & " </script>"
]

#
#
# Full Page

Set Variable [ $$Modal ; Value:
    "<!DOCTYPE html>
    <html lang='en'>

    <head>
       <meta charset='UTF-8'>
       <meta name='viewport' content='width=device-width, initial-scale=1.0'>
       <title>Modal Page</title>
       <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css'>
       <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css'>
       <script src='https://cdn.jsdelivr.net/npm/flatpickr'></script>
       <style> " & $styles & " </style>
    </head>

    <body> " & $HTML & "¬∂¬∂" & $Scripts & " </body>

    </html>
    "
]

#
#
# ******************************************
# ******************************************
# GENERATE PAGE (END)
# ******************************************
# ******************************************
#

New Window [ Style: Card ; Name: "" ; Layout: "Modal" (165) ; Height: 750 ; Width: 600 ;
             Dim parent window: Yes ; Close: No ; Minimize: No ; Maximize: No ;
             Zoom control area: No ; Menu bar: No ; Resize: No ]